          <script>
            const id = "hybrix-jslib"
            initNavigation(id)
          </script>

          <h1>hybrix-jslib</h1>

          <p>This Javascript library can be used to connect software
          to leverage the capabilities of the hybrix platform. It
          serves two purposes: first to facilitate the logistics of
          interfacing with
          the <a href="./api">hybrixd
          API</a>, secondly to handle all client-side operations
          securely and privately. This ensures that keys required for
          transactions never leave the users device and communication
          happens over an encrypted channel.</p>

          <a href="https://download.hybrix.io/releases/hybrix-jslib/latest/hybrix-lib.web.js" target="_blank" download>
            <div class="download" style="min-width: 320px;">
              <svg width="20px" height="20px" viewBox="0 0 26 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                      <g transform="translate(-359.000000, -914.000000)" fill="#FFFFFF" fill-rule="nonzero">
                          <g transform="translate(359.000000, 914.000000)">
                              <path d="M13,0 C5.79090909,0 0,5.79090909 0,13 C0,20.2090909 5.79090909,26 13,26 C20.2090909,26 26,20.2090909 26,13 C26,5.79090909 20.2090909,0 13,0 Z M23.5181818,11.8181818 L18.7909091,11.8181818 C18.5545455,8.50909091 17.4909091,5.43636364 15.6,2.71818182 C19.8545455,3.78181818 23.0454545,7.44545455 23.5181818,11.8181818 Z M9.57272727,14.1818182 L16.5454545,14.1818182 C16.1909091,17.3727273 15.0090909,20.4454545 13.1181818,22.9272727 C10.9909091,20.4454545 9.80909091,17.3727273 9.57272727,14.1818182 L9.57272727,14.1818182 Z M9.57272727,11.8181818 C9.92727273,8.62727273 11.1090909,5.55454545 13,3.07272727 C15.0090909,5.67272727 16.1909091,8.74545455 16.4272727,11.8181818 L9.57272727,11.8181818 L9.57272727,11.8181818 Z M10.2818182,2.71818182 C8.50909091,5.43636364 7.44545455,8.50909091 7.20909091,11.8181818 L2.48181818,11.8181818 C2.95454545,7.44545455 6.14545455,3.78181818 10.2818182,2.71818182 Z M2.48181818,14.1818182 L7.20909091,14.1818182 C7.44545455,17.4909091 8.50909091,20.5636364 10.4,23.2818182 C6.14545455,22.2181818 2.95454545,18.5545455 2.48181818,14.1818182 Z M15.7181818,23.2818182 C17.4909091,20.5636364 18.5545455,17.4909091 18.9090909,14.1818182 L23.6363636,14.1818182 C23.0454545,18.5545455 19.8545455,22.2181818 15.7181818,23.2818182 Z" ></path>
                          </g>
                      </g>
                  </g>
              </svg>
              <span class="download-text">Download for web</span>
              <span class="usage">&lt;script src="./hybrix-lib.web.js"&gt;&lt;/script&gt;</span>
            </div>
          </a>
          <br/>
          <a href="https://download.hybrix.io/releases/hybrix-jslib/latest/hybrix-lib.nodejs.js" target="_blank" download>
            <div class="download" style="min-width: 320px; margin-top: 0px;">
              <svg width="20px" height="20px" viewBox="0 0 26 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g stroke="none" stroke-width="1" fill="transparent" fill-rule="evenodd" stroke-linejoin="round">
                    <g transform="translate(-359.000000, -1024.000000)" stroke="#FFFFFF" stroke-width="2.6">
                        <polygon points="372 1026 383.25833 1032.5 383.25833 1045.5 372 1052 360.74167 1045.5 360.74167 1032.5" fill="transparent"></polygon>
                    </g>
                </g>
            </svg>
              <span class="download-text">Download for NodeJS</span>
              <span class="usage">const Hybrix = require('./hybrix-lib.nodejs');</span>
            </div>
          </a>
          <br/>
          <a href="https://www.npmjs.com/package/hybrix-jslib" target="_blank" download>
            <div class="download" style="min-width: 320px; margin-top: 0px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24px" height="24px" style="margin-left:-2px; margin-right: 8px;">
                <path fill="#FFFFFF" d="M0,15h48v17H24v3H13v-3H0V15z"/>
                <path fill="#57C5B3" d="M3 29L8 29 8 21 11 21 11 29 13 29 13 18 3 18zM16 18v14h5v-3h5V18H16zM24 26h-3v-5h3V26zM29 18L29 29 34 29 34 21 37 21 37 29 40 29 40 21 43 21 43 29 45 29 45 18z"/>
              </svg>
              <span class="download-text">Install using NPM</span>
              <span class="usage">$ npm install hybrix-jslib <br/> const Hybrix = require('./hybrix-lib');</span>
            </div>
          </a>

           <h2><a id="quick-start"></a>Quick start</h2>

          <p>There are two flavours of the library: the web version to include in your webpage or front-end, and the node js version to include when you are building back-end software.</p>

          <p>Here is a Hello World example of how to use hybrix-lib.js in your front-end. First include the library using script tags.</p>

          <pre><code class="language-html">&lt;html&gt;
&nbsp;&lt;head&gt;
&nbsp;&nbsp;&lt;script src='hybrix-lib.web.js'&gt;&lt;/script&gt;
&nbsp;&lt;/head&gt;
&nbsp;&lt;body&gt;
 &nbsp;&lt;script&gt;
   var hybrix = new Hybrix.Interface();
   hybrix.sequential(
    [
     {host:'https://api.hybrix.io/'}, 'addHost'                     //  Connect to host
    ],
    host => alert('Connected to '+ host),                           // Define action to execute on successfull completion
    error => alert('Oops, something went wrong: '+error)           // Define action to exectue when an error is encountered
   );
 &nbsp;&lt;/script&gt;
&nbsp;&lt;/body&gt;
&lt;/html&gt;
</code></pre>

          <p>For nodejs projects:</p>

          <pre><code class="language-js">const Hybrix = require('./hybrix-lib.nodejs.js');
const hybrix = new Hybrix.Interface();
hybrix.sequential(
  [
   {host:'https://api.hybrix.io/'}, 'addHost'                     //  Connect to host
  ],
  host => console.log('Connected to '+ host),                     // Define action to execute on successfull completion
  error => console.error('Oops, something went wrong: ' + error)  // Define action to exectue when an error is encountered
);</code></pre>

<p>Or using npm:</p>

 <p> Install the package using npm
   <code class="prompt">npm install hybrix-jslib</code>
 </p>

  <pre><code class="language-js">const Hybrix = require('hybrix-jslib');
const hybrix = new Hybrix.Interface();
hybrix.sequential(
  [
   {host:'https://api.hybrix.io/'}, 'addHost'                     //  Connect to host
  ],
  host => console.log('Connected to '+ host),                     // Define action to execute on successfull completion
  error => console.error('Oops, something went wrong: ' + error)  // Define action to exectue when an error is encountered
);</code></pre>


          <h2><a id="callbacks"></a>Callbacks</h2>

          <p>Each command is implemented as a member function of the Hybrix.Interface class. Adding a host can be done as follows.</p>

          <pre><code class="language-js">hybrix.addHost({host:'https://www.example.com'});</code></pre>

          <p>Here only one parameter is passed but each member function has four parameters: data, onSuccess, onError and onProgress.</p>

          <p>The first is used to pass parameter data to the function. The last three are callback functions. onSuccess is called once when the method has finished successfully. onError is called once when an error is encountered. onProgress is called whenever a progress update is available, passing a number between 0 and 1, and 1 upon completion.</p>

          <p>To first add a host and then query for asset balance one could try the following:</p>


<pre><code class="language-js">hybrix.addHost({host:'https://www.example.com'});  // This is an asynchronous function. It can take some time to complete.
hybrix.rout({query: 'Query for asset balance'});   // Problem! This will try to request routing before the addition of the host is done.</code></pre>


          <p>This results in serious problems due to asynchronicity. One could use the callbacks to ensure the execution order.</p>

          <pre><code class="language-js">hybrix.addHost({host:'https://www.example.com'},
  function(){
    hybrix.rout({query:'/asset/btc/balance/32FCGFdRGeho2HBeWQPaAYawJfPqHHvsCJ'});     //  This will now be called after the addition of the host is successfully completed.
  }
);
</code></pre>

          <p>But adding more steps or error handling will end up with code that is both very hard to read and maintain. (This is sometimes dubbed <i>callback hell</i>.) To mitigate this the library comes equiped with a sequential and a parallel command to handle these asynchronious call flows. With an added bonus of handling the progress for combined commands as well.</p>

          <pre><code class="language-js">hybrix.sequential([
{host: 'http://localhost:1111/'}, 'addHost',                   // Add and initialize the host
{query: '/asset/btc/balance/32FCGFdRGeho2HBeWQPaAYawJfPqHHvsCJ'}, 'rout'  // Query for asset balance
],
onSuccess,                                                      // Define action to execute on successfull completion
onError,                                                        // Define action to execute when an error is encountered
onProgress                                                      // Define action to execute whenever there is a progress update
);</code></pre>

          <pre id="exampleHelloWorld" style="display: none">hybrix.sequential([
{host: 'http://localhost:1111/'}, 'addHost',                   // Add and initialize the host
{query: '/asset/btc/balance/32FCGFdRGeho2HBeWQPaAYawJfPqHHvsCJ'}, 'rout'  // Query for asset balance
],
onSuccess,                                                      // Define action to execute on successfull completion
onError,                                                        // Define action to execute when an error is encountered
onProgress                                                      // Define action to execute whenever there is a progress update
);</pre>

          <p>For even more complex behaviour we advice you to implement your own favourite flavour method of handling the call flow, be it <i>promises</i>, <i>streams</i>, or <i>async</i>, etc.</p>

<!--



         <h3>Connectors</h3>

            <p>The connector is the method that is used to make calls to the host. For NodeJS the http and/or https modules can be used:

<pre><code class="language-js">const hybrix = new Hybrix.Interface({http:require('http')}); // Provide a http connector
const hybrix = new Hybrix.Interface({https:require('https')}); // Provide a https connector
const hybrix = new Hybrix.Interface({http:require('http'),https:require('https')}); // Default. Provide http and https connectors for mixed usage
</code></pre>

              <p>For web/html implementations the XMLHttpRequest method is used which is supplied by the browser.</p>

              <pre><code class="language-js">const hybrix = new Hybrix.Interface({XMLHttpRequest:XMLHttpRequest}); // Default</code></pre>

              <p>There is also the option to define a custom connector which should be a function with the following signature:</p>

<pre><code class="language-js">(host,query,dataCallback,errorCallback) => {
  // do the call to the host using the query and return the result or error
  if(error){
    errorCallback(error);
  }else{
    dataCallback(result);
  }
}
</code></pre>

-->


          <h2><a id="live-example"></a>Live example</h2>

          <div class="example-block">
            <div class="try">
              <select id="selectExample" onchange="const
                                                   s=document.getElementById('selectExample');
                                                   const exampleCode =
                                                   replaceHostInCode(document.getElementById(s[s.selectedIndex].value).innerHTML)
                                                   codeMirrorEditor.setValue(exampleCode);">


                <option value="exampleHelloWorld">Hello World</option>
              </select>

              <script>
                function replaceHostInCode(code){
                  return code.replace(/http\:\/\/localhost\:1111/g,window.location.href.split(`/help`)[0]).replace(/<[^>]*>/g,'');
                }
               var codeMirrorEditor;
               setTimeout(function(){
                 var examples = document.getElementsByClassName('example');
                 var selectExample = document.getElementById('selectExample');
                 for (let example of examples) {
                   var option = document.createElement('OPTION');
                   option.value= example.id;
                   option.innerHTML = example.title;
                   selectExample.appendChild(option);
                   var button = document.createElement('input');
                   button.type='submit';
                   button.value="Try it!";

                   button.onclick = function(body,id){
                     return event => {
                       const exampleCode = replaceHostInCode(body);
                       codeMirrorEditor.setValue(exampleCode)
                       for(let option of document.getElementById('selectExample').options){
                         if(option.value===id){
                           option.selected='selected';
                         }
                       }
                       const tr = document.getElementById('try').parentNode;
                       tr.scrollIntoView();
                       runExample(event);
                     }
                   }(example.innerHTML,example.id);
                   example.parentNode.insertBefore(button, example.nextSibling);
                 }
                 document.getElementById('try').innerHTML=replaceHostInCode(document.getElementById('exampleHelloWorld').innerHTML);

                 codeMirrorEditor = CodeMirror.fromTextArea(document.getElementById("try"), {
                     mode: "application/javascript",
                     lineWrapping:false,
                     lineNumbers:true,
                     matchBrackets:false,
                     scrollbarStyle:null,
                     fixedGutter:true
                   });
                   codeMirrorEditor.setOption("theme", "mdn-like");

               },250);
              </script>

              <textarea id="try" autocomplete="off" autocapitalize="off" spellcheck="false"></textarea>

              <p>Progress</p>
              <div id="progressContainer">
                <div id="progress"></div>
              </div>

              <p>Result</p>
              <div id="result">...</div>

            </div>

            <input type="submit" value="Try it!" onclick="runExample(event)">
          </div>

          <h2 style="margin-bottom: 20px;"><a id="reference"></a>Reference</h2>
